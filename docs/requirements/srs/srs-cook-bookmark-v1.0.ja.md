# ソフトウェア要求仕様書（SRS）

**プロジェクト名**: Cook Bookmark
**バージョン**: 1.0
**作成日**: 2026-02-14
**作成者**: Requirements Analyst AI

---

## 1. はじめに

### 1.1 目的

本ドキュメントはCook Bookmarkのソフトウェア要求を定義します。Cook Bookmarkは、レシピURLから生成AI（Gemini API）を使用してレシピ情報を自動抽出し、個人・家族専用のレシピコレクションを構築するWebアプリケーションです。

### 1.2 スコープ

**対象範囲:**

- Google OAuthによるユーザー認証
- レシピURL登録とAIによるレシピ情報自動抽出
- レシピのCRUD操作（作成・閲覧・更新・削除）
- レシピの整理（カテゴリ、タグ、お気に入り）
- レシピの検索・フィルタリング
- 家族間でのレシピ共有（共有コレクション）
- 星5段階の評価システム
- モバイルファーストのレスポンシブデザイン

**対象外:**

- メール/パスワードによるユーザー登録
- マルチテナント対応（単一家族グループのみ）
- 献立計画・カレンダー連携
- 買い物リスト生成
- ソーシャル機能（コメント、一般公開）
- ネイティブモバイルアプリ（PWAは将来検討）

### 1.3 定義・略語

- **レシピURL**: レシピ情報を含むWebページのURL
- **AI抽出**: Gemini APIを使用したレシピデータの自動抽出・整形
- **共有コレクション**: 認証済み家族メンバー全員が閲覧可能な単一のレシピリスト
- **SRS**: ソフトウェア要求仕様書
- **MVP**: 最小限の実用的な製品
- **CRUD**: 作成・読取・更新・削除

### 1.4 参照文書

- Better Auth ドキュメント
- Gemini API ドキュメント
- Next.js App Router ドキュメント
- Drizzle ORM ドキュメント

---

## 2. システム概要

### 2.1 システムの目的

Cook Bookmarkは以下を実現します:

1. あらゆる料理サイトからレシピURLを保存
2. Gemini AIを使用してレシピデータを自動抽出
3. 個人・家族コレクションにレシピを保存
4. レシピの検索・フィルタリング・整理
5. 家族の反応に基づくレシピ評価

### 2.2 ユーザー

- **主要ユーザー**: 夫婦（2名）— レシピ登録・評価・検索
- **副次ユーザー**: その他の家族（最大3名）— 共有レシピの閲覧・検索
- **合計**: 5人未満

### 2.3 対象環境

- **デバイス**: スマートフォン（メイン）、デスクトップ（サブ）
- **ブラウザ**: Chrome、Safari（モバイル）
- **ネットワーク**: インターネット接続必須
- **ホスティング**: Vercel（サーバーレス）
- **データベース**: Turso（SQLite互換、サーバーレス）

---

## 3. 現在の実装状況

以下のコンポーネントはすでに実装済みです。

### 3.1 技術スタック（実装済み）

| コンポーネント | 技術 | バージョン |
|---|---|---|
| フレームワーク | Next.js（App Router） | 16.1.6 |
| 言語 | TypeScript | 5.x |
| ランタイム | React | 19.2.3 |
| 認証 | Better Auth | 1.4.18 |
| データベース | Turso（libSQL） | 0.17.0 |
| ORM | Drizzle ORM | 0.45.1 |
| UIコンポーネント | shadcn/ui（Radix UI） | 1.4.3 |
| スタイリング | Tailwind CSS | 4.x |
| アイコン | Lucide React | 0.564.0 |
| デプロイ | Vercel | - |

### 3.2 実装済み機能

| 機能 | ステータス | 詳細 |
|---|---|---|
| Googleログイン | 完了 | Better Auth + Googleソーシャルプロバイダー |
| セッション管理 | 完了 | Cookie（HTTP/HTTPS対応） |
| ルート保護 | 完了 | `/dashboard/*`のミドルウェア保護 |
| 認証DBスキーマ | 完了 | user, session, account, verificationテーブル |
| ランディングページ | 完了 | `/` ナビゲーション付き |
| ログインページ | 完了 | `/login` Googleサインインボタン |
| ダッシュボード | プレースホルダー | `/dashboard`「Hello World」表示 |
| Vercelデプロイ | 完了 | vercel.json設定済み |

### 3.3 実装済みデータベーススキーマ

**テーブル（Better Auth）:**

- `user` — id, name, email（ユニーク）, emailVerified, image, createdAt, updatedAt
- `session` — id, expiresAt, token（ユニーク）, userId（FK→user）, ipAddress, userAgent
- `account` — id, accountId, providerId, userId（FK→user）, accessToken, refreshToken, idToken, scope
- `verification` — id, identifier, value, expiresAt

### 3.4 準備済み・未使用

- `GEMINI_API_KEY` 環境変数（.env.localに設定済み）
- Drizzle Kitマイグレーションスクリプト（db:generate, db:migrate, db:push, db:studio）

---

## 4. 機能要件

### 4.1 認証（実装済み）

- **FR-001**: システムはGoogle OAuth 2.0でユーザーを認証するものとする
- **FR-002**: システムはセキュアCookieでユーザーセッションを維持するものとする
- **FR-003**: システムは未認証ユーザーをログインページにリダイレクトするものとする
- **FR-004**: システムはユーザーのサインアウトを許可するものとする

### 4.2 レシピURL登録

- **FR-010**: ユーザーがURLを送信した場合、システムはWebページの内容を取得・解析するものとする
- **FR-011**: ページ内容を取得した場合、システムはGemini APIに送信してレシピを抽出するものとする
- **FR-012**: Gemini APIは以下のフィールドを抽出・返却するものとする:
  - 料理名
  - 材料リスト（分量付き）
  - 調理手順（ステップ形式）
  - 調理時間
  - 人数（何人前）
  - カロリー・栄養情報
  - 写真URL（元サイトから）
- **FR-013**: フィールドが抽出できない場合、システムは空欄にするかAI推定で補完するものとする
- **FR-014**: 抽出が完了した場合、システムは保存前にユーザー確認用にデータを表示するものとする
- **FR-015**: システムは各レシピに元のURLを保存するものとする

### 4.3 レシピ管理

- **FR-020**: システムは登録済みレシピの一覧を表示するものとする
- **FR-021**: システムはレシピの任意のフィールドの編集を許可するものとする
- **FR-022**: システムはレシピの削除を許可するものとする
- **FR-023**: システムはレシピへのカテゴリ割り当てを許可するものとする（例: 和食、洋食、中華）
- **FR-024**: システムはレシピへのタグ追加を許可するものとする
- **FR-025**: システムはレシピのお気に入り登録を許可するものとする

### 4.4 レシピ検索・フィルタリング

- **FR-030**: システムはキーワード検索（料理名、材料）を提供するものとする
- **FR-031**: システムはカテゴリ別フィルタリングを提供するものとする
- **FR-032**: システムはタグ別フィルタリングを提供するものとする
- **FR-033**: システムはお気に入りのみのフィルタリングを提供するものとする
- **FR-034**: システムは星評価順のソートを提供するものとする

### 4.5 家族間共有

- **FR-040**: すべての認証済みユーザーは同じ共有レシピコレクションを閲覧できるものとする
- **FR-041**: すべての認証済みユーザーはレシピの登録・編集・削除ができるものとする
- **FR-042**: システムは各レシピの登録者を表示するものとする

### 4.6 星評価

- **FR-050**: システムはレシピ登録者に1〜5の星評価を許可するものとする
- **FR-051**: システムはレシピ一覧・詳細画面に星評価を表示するものとする
- **FR-052**: システムは登録者による評価の更新を許可するものとする

---

## 5. 非機能要件

### 5.1 パフォーマンス

- **NFR-001**: 標準的なパフォーマンスで十分（家族利用、2〜5名）
- **NFR-002**: AI抽出は数秒かかる場合があり、ローディングインジケーターを表示するものとする

### 5.2 可用性

- **NFR-010**: システムはVercelの標準的な稼働率でホスティングするものとする
- **NFR-011**: データベースはTursoの自動バックアップ機能を利用するものとする

### 5.3 セキュリティ

- **NFR-020**: 認証はGoogle OAuth 2.0のみとする
- **NFR-021**: セッションCookieは本番環境でHttpOnlyおよびSecureフラグを使用するものとする
- **NFR-022**: すべての通信はHTTPSを使用するものとする

### 5.4 ユーザビリティ

- **NFR-030**: UIはモバイルファーストとする（キッチンでスマートフォン使用を想定）
- **NFR-031**: UIはレスポンシブとする（デスクトップでも利用可能）
- **NFR-032**: UI言語は日本語とする

### 5.5 保守性

- **NFR-040**: システムは型安全性のためTypeScriptを使用するものとする
- **NFR-041**: データベーススキーマはDrizzle ORMマイグレーションで管理するものとする
- **NFR-042**: システムはVercelでゼロ設定デプロイ可能とする

### 5.6 制約

- **NFR-050**: 開発期間: 1ヶ月（MVP）
- **NFR-051**: Gemini APIの利用はレート制限と料金に従う
- **NFR-052**: Turso無料枠のデータベース制限が適用される

---

## 6. 外部インターフェース

### 6.1 ユーザーインターフェース

- Tailwind CSS + shadcn/uiを使用したモバイルファーストのレスポンシブデザイン
- 日本語UI
- 主要画面:
  - ランディングページ（`/`）
  - ログインページ（`/login`）
  - ダッシュボード / レシピ一覧（`/dashboard`）
  - レシピ詳細ページ
  - レシピ登録フォーム（URL入力 + AI抽出プレビュー）
  - レシピ編集フォーム

### 6.2 ソフトウェアインターフェース

| インターフェース | 目的 | プロトコル |
|---|---|---|
| Gemini API | URLコンテンツからのレシピ抽出 | HTTPS / REST |
| Google OAuth | ユーザー認証 | OAuth 2.0 |
| Turso Database | データ永続化 | libSQL（HTTPS） |

### 6.3 通信インターフェース

- **プロトコル**: HTTPS（TLS）
- **データフォーマット**: JSON
- **APIスタイル**: Next.js API Routes（App Router）

---

## 7. データモデル（新規追加テーブル）

既存スキーマに以下のテーブルを追加する必要があります。

### 7.1 recipe

| カラム | 型 | 説明 |
|---|---|---|
| id | text（PK） | 一意識別子 |
| title | text | 料理名 |
| sourceUrl | text | 元のレシピURL |
| ingredients | text（JSON） | 材料リスト（分量付き） |
| steps | text（JSON） | 調理手順 |
| cookingTime | text | 調理時間 |
| servings | text | 人数 |
| calories | text | カロリー情報 |
| nutrition | text（JSON） | 栄養情報 |
| imageUrl | text | 写真URL |
| rating | integer | 星評価（1〜5、null可） |
| isFavorite | integer（boolean） | お気に入りフラグ |
| categoryId | text（FK） | カテゴリ参照 |
| createdBy | text（FK→user） | 登録ユーザー |
| createdAt | integer（timestamp） | 作成日時 |
| updatedAt | integer（timestamp） | 更新日時 |

### 7.2 category

| カラム | 型 | 説明 |
|---|---|---|
| id | text（PK） | 一意識別子 |
| name | text（ユニーク） | カテゴリ名（例: 和食、洋食） |
| createdAt | integer（timestamp） | 作成日時 |

### 7.3 tag

| カラム | 型 | 説明 |
|---|---|---|
| id | text（PK） | 一意識別子 |
| name | text（ユニーク） | タグ名 |
| createdAt | integer（timestamp） | 作成日時 |

### 7.4 recipe_tag（中間テーブル）

| カラム | 型 | 説明 |
|---|---|---|
| recipeId | text（FK→recipe） | レシピ参照 |
| tagId | text（FK→tag） | タグ参照 |

---

## 8. MVP優先順位付け（MoSCoW）

### Must Have（MVPリリース）

- FR-001〜004: Googleログイン（完了）
- FR-010〜015: レシピURL登録 + AI抽出
- FR-020〜022: レシピ一覧・編集・削除
- FR-030: キーワード検索
- FR-040〜042: 家族共有コレクション

### Should Have

- FR-023〜024: カテゴリ・タグ分類
- FR-025: お気に入り
- FR-033: お気に入りフィルター
- FR-050〜052: 星評価
- FR-031〜032: カテゴリ・タグフィルター
- FR-034: 評価順ソート

### Could Have

- FR-012（カロリー・栄養）: カロリー・栄養情報
- FR-012（写真）: 写真URL抽出
- 高度な検索（調理時間フィルター）

---

## 付録A: 用語集

| 用語 | 定義 |
|---|---|
| Cook Bookmark | アプリケーション名 |
| レシピURL | 料理レシピを含むWebページのURL |
| AI抽出 | Gemini APIを使用した自動レシピデータ抽出 |
| 共有コレクション | 家族メンバー全員で共有する単一のレシピリスト |
| 星評価 | レシピの1〜5段階評価 |

## 付録B: 変更履歴

| バージョン | 日付 | 変更内容 | 作成者 |
|---|---|---|---|
| 1.0 | 2026-02-14 | 初版作成 | Requirements Analyst AI |
